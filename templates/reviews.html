{% extends "base.html" %}

{% block title %}–û—Ç–∑—ã–≤—ã - –¢–ù–° —ç–Ω–µ—Ä–≥–æ –ù–ù{% endblock %}

{% block content %}
<h2 style="margin-bottom: 2rem;">üìù –í—Å–µ –æ—Ç–∑—ã–≤—ã</h2>

<div class="card">
    <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
    <form method="get" style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
        <select name="source" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
            <option value="vk" {% if source == 'vk' %}selected{% endif %}>VK</option>
            <option value="telegram" {% if source == 'telegram' %}selected{% endif %}>Telegram</option>
            <option value="web" {% if source == 'web' %}selected{% endif %}>Web</option>
        </select>
        
        <select name="sentiment" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">–í—Å–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</option>
            <option value="positive" {% if sentiment == 'positive' %}selected{% endif %}>–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ</option>
            <option value="negative" {% if sentiment == 'negative' %}selected{% endif %}>–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ</option>
            <option value="neutral" {% if sentiment == 'neutral' %}selected{% endif %}>–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ</option>
        </select>
        
        <select name="status" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="pending" {% if status == 'pending' %}selected{% endif %}>–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</option>
            <option value="approved" {% if status == 'approved' %}selected{% endif %}>–û–¥–æ–±—Ä–µ–Ω–æ</option>
            <option value="rejected" {% if status == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
        </select>
        
        <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                <th>–ê–≤—Ç–æ—Ä</th>
                <th>–û—Ç–∑—ã–≤</th>
                <th>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for review in pagination.items %}
            <tr>
                <td>{{ review.collected_date.strftime('%d.%m.%Y %H:%M') if review.collected_date else '-' }}</td>
                <td><strong>{{ review.source.upper() }}</strong></td>
                <td>{{ review.author or '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</td>
                <td>{{ review.text[:100] }}{% if review.text|length > 100 %}...{% endif %}</td>
                <td>
                    {% if review.sentiment_label == 'positive' %}
                        <span class="badge badge-positive">–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π</span>
                    {% elif review.sentiment_label == 'negative' %}
                        <span class="badge badge-negative">–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π</span>
                    {% else %}
                        <span class="badge badge-neutral">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</span>
                    {% endif %}
                </td>
                <td>
                    {% if review.requires_manual_review %}
                        <span class="badge badge-pending">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                    {% elif review.moderation_status == 'approved' %}
                        <span class="badge badge-approved">–û–¥–æ–±—Ä–µ–Ω</span>
                    {% elif review.moderation_status == 'rejected' %}
                        <span class="badge badge-rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω</span>
                    {% else %}
                        <span class="badge badge-neutral">–ù–æ–≤—ã–π</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('review_detail', review_id=review.id) }}" class="btn btn-primary" style="padding: 0.3rem 0.8rem;">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div style="margin-top: 2rem; display: flex; justify-content: center; gap: 1rem;">
        {% if pagination.has_prev %}
            <a href="{{ url_for('reviews_list', page=pagination.prev_num, source=source, sentiment=sentiment, status=status) }}" class="btn btn-primary">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}
        
        <span style="padding: 0.5rem 1rem;">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pagination.page }} –∏–∑ {{ pagination.pages }}</span>
        
        {% if pagination.has_next %}
            <a href="{{ url_for('reviews_list', page=pagination.next_num, source=source, sentiment=sentiment, status=status) }}" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
        {% endif %}
    </div>
</div>
{% endblock %}
